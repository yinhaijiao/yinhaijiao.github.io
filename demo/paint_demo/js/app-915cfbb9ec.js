function PVVectprField(){this._buffer,this.cols,this.rows,this.cols_m1,this.rows_m1,this.width,this.height,this.nTotal,this.nTotalx2,this.outX,this.outY,this.fieldPosX,this.fieldPosY,this.mPos}function PVParticle(){this.flg=!1,this.angle=0,this.scale=0,this.int=0,this.velX=0,this.posX=0,this.velY=0,this.posY=0,this.life=0,this.damping=.035,this.r=0,this.g=0,this.b=0}!function(t,i){"object"==typeof exports&&"undefined"!=typeof module?module.exports=i():"function"==typeof define&&define.amd?define(i):t.Stats=i()}(this,function(){var t=function(){function i(t){return o.appendChild(t.dom),t}function e(t){for(var i=0;i<o.children.length;i++)o.children[i].style.display=i===t?"block":"none";s=t}var s=0,o=document.createElement("div");o.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",o.addEventListener("click",function(t){t.preventDefault(),e(++s%o.children.length)},!1);var r=(performance||Date).now(),n=r,h=0,a=i(new t.Panel("FPS","#0ff","#002")),l=i(new t.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var m=i(new t.Panel("MB","#f08","#201"));return e(0),{REVISION:16,dom:o,addPanel:i,showPanel:e,begin:function(){r=(performance||Date).now()},end:function(){h++;var t=(performance||Date).now();if(l.update(t-r,200),t>n+1e3&&(a.update(1e3*h/(t-n),100),n=t,h=0,m)){var i=performance.memory;m.update(i.usedJSHeapSize/1048576,i.jsHeapSizeLimit/1048576)}return t},update:function(){r=this.end()},domElement:o,setMode:e}};return t.Panel=function(t,i,e){var s=1/0,o=0,r=Math.round,n=r(window.devicePixelRatio||1),h=80*n,a=48*n,l=3*n,m=2*n,c=3*n,f=15*n,d=74*n,u=30*n,p=document.createElement("canvas");p.width=h,p.height=a,p.style.cssText="width:80px;height:48px";var M=p.getContext("2d");return M.font="bold "+9*n+"px Helvetica,Arial,sans-serif",M.textBaseline="top",M.fillStyle=e,M.fillRect(0,0,h,a),M.fillStyle=i,M.fillText(t,l,m),M.fillRect(c,f,d,u),M.fillStyle=e,M.globalAlpha=.9,M.fillRect(c,f,d,u),{dom:p,update:function(a,v){s=Math.min(s,a),o=Math.max(o,a),M.fillStyle=e,M.globalAlpha=1,M.fillRect(0,0,h,f),M.fillStyle=i,M.fillText(r(a)+" "+t+" ("+r(s)+"-"+r(o)+")",l,m),M.drawImage(p,c+n,f,d-n,u,c,f,d-n,u),M.fillRect(c+d-n,f,n,u),M.fillStyle=e,M.globalAlpha=.9,M.fillRect(c+d-n,f,n,r((1-a/v)*u))}}},t}),PVVectprField.prototype.setupField=function(t,i,e,s){let o=0;for(this.cols=t,this.rows=i,this.cols_m1=this.cols-1,this.rows_m1=this.rows-1,this.width=e,this.height=s,this.nTotal=this.cols*this.rows,this.nTotalx2=2*this.nTotal,this.dispose(),this._buffer=new Array,o=0;o<this.nTotalx2;)this._buffer.push(0),++o},PVVectprField.prototype.dispose=function(){this._buffer=null},PVVectprField.prototype.clear=function(){let t=0;for(;t<this.nTotalx2;)this._buffer[t]=0,++t},PVVectprField.prototype.getForceFromPos=function(t,i){if(t/=this.width,i/=this.height,t<0||t>1||i<0||i>1)return this.outX=0,void(this.outY=0);this.fieldPosX=t*this.cols,this.fieldPosY=i*this.rows,this.mPos=2*Math.trunc(this.fieldPosY*this.cols+this.fieldPosX),this.outX=.1*this._buffer[this.mPos],this.outY=.1*this._buffer[this.mPos+1]},PVVectprField.prototype.addVectorCircle=function(t,i,e,s,o,r){var n,h=0,a=0,l=0,m=t/this.width*this.cols,c=i/this.height*this.rows,f=o/this.width*this.cols,d=m-f,u=c-f,p=m+f,M=c+f;for(d<0&&(d=0),u<0&&(u=0),p>this.cols&&(p=this.cols),M>this.rows&&(M=this.rows),l=d;l<p;){for(h=u;h<M;){if(a=2*(h*this.cols+l),(n=Math.sqrt((m-l)*(m-l)+(c-h)*(c-h)))<1e-4&&(n=1e-4),n<f){n=1-n/f,n*=r;let t=a,i=this._buffer[Math.trunc(t)]+e*n;this._buffer[Math.trunc(t)]=i,i=a+1,t=this._buffer[Math.trunc(i)]+s*n,this._buffer[Math.trunc(i)]=t}++h}++l}},PVVectprField.prototype.fadeField=function(t){let i=0;for(;i<this.nTotalx2;){let e=Math.trunc(i),s=this._buffer[e]*t;this._buffer[e]=s,++i}},PVParticle.prototype.setInitialCondition=function(t,i,e,s,o){this.posX=t,this.posY=i,this.velX=e,this.velY=s,this.life=o},PVParticle.prototype.setVFupdate=function(t,i){this.velX=this.velX+(t-this.velX*this.damping),this.velY=this.velY+(i-this.velY*this.damping),this.posX=this.posX+this.velX,this.posY=this.posY+this.velY,this.life=this.life-1};const STAGE_GLOBAL_DRAWABLE_CENTERY=0,ScaleMaxPaint=1.16,ScaleMin=.6,IMAGE_WIDTH=398,IMAGE_HEIGHT=500,IMAGE_MARGIN_Y=12,IMAGE_MARGIN_X=25,PAINT_RADIUS=2;function Easing(){}Easing.prototype.easeOutQuart=function(t,i,e,s){return-e*((t=t/s-1)*t*t*t-1)+i},Easing.prototype.easeInOutQuart=function(t,i,e,s){return(t/=s/2)<1?e/2*t*t*t*t+i:-e/2*((t-=2)*t*t*t-2)+i};const colorCols=[[13209,15073299,16773120,0],[16727423,16752285,16771491,10013846,4176047],[15466892,3342540],[16764159,10079385],[16776960,13421772],[0,13092817,16711680],[0,5329233,8750469],[26367,16763904,16711680],[15073299,16694244,16772608,3059457,45013,3215303,15466892,0]],easing=new Easing;function Draw(){}var draw;function init(){(draw=new Draw).init()}Draw.prototype.init=function(){this.canvas=document.getElementById("cas"),this.ctx=this.canvas.getContext("2d"),this.canvas.width=398,this.canvas.height=500,this.mParticles=[],this.mVF=new PVVectprField,this.mVF.setupField(398/630,500/630,398,500),this.moveFlag=!1,this.isZoom=!1,this._toScale=0,this._frScale,this._ticktime,this._zoomTryed=!1,this._drawingEnabled=!0,this.mStageWidth=398,this.mStageHeight=500,this.currentScale=1.16,this.mResolutionScale=398/window.innerWidth,this.mColorRandRange=1,this.mActiveColor=13209,this._eraseMode=!1,this.mFudeSize=1.2,this.mUniformMatrix=new Array(4),this.mUniformColor=new Array(4),console.log(`canvas.width: ${this.canvas.width}, canvas.height: ${this.canvas.height}`),this.canvas.addEventListener("touchstart",this.startEvent.bind(this),!1),this.canvas.addEventListener("touchmove",this.moveEvent.bind(this),!1),this.canvas.addEventListener("touchend",this.endEvent.bind(this),!1),this.animloop()},Draw.prototype.animloop=function(){requestAnimFrame(this.animloop.bind(this)),this.onEnterFrame()},Draw.prototype.getXY=function(t){const i=t.touches?t.touches[0].clientX:t.clientX,e=t.touches?t.touches[0].clientY:t.clientY;return{x:i-this.canvas.offsetLeft+(document.body.scrollLeft||document.documentElement.scrollLeft),y:e-this.canvas.offsetTop+(document.body.scrollTop||document.documentElement.scrollTop)}},Draw.prototype.startEvent=function(t){let i=this.getXY(t);this.mPrevMouseX=i.x,this.mPrevMouseY=i.y,this.mPrevDiffX=0,this.mPrevDiffY=0,this.moveFlag=!0},Draw.prototype.moveEvent=function(t){if(!this.moveFlag)return;let i,e,s,o,r,n,h,a,l,m,c,f,d,u,p,M,v,w,g,x,P,_,y,U,S,C=this.getXY(t);for(P=C.x,x=C.y,r=P-this.mPrevMouseX,n=x-this.mPrevMouseY,u=Math.max(Math.sqrt(r*r+n*n)/3,1),d=0;d<u;){for(o=(d+1)/u,e=P-this.mPrevMouseX,s=x-this.mPrevMouseY,e*=o,s*=o,e=this.mPrevMouseX+e,s=this.mPrevMouseY+s,g=r-this.mPrevDiffX,M=n-this.mPrevDiffY,g*=o,M*=o,g=this.mPrevDiffX+g,M=this.mPrevDiffY+M,l=.2+Math.min(this.mFudeSize,Math.sqrt(g*g+M*M)/50),this.mVF.addVectorCircle(e,s,.5*g,.5*M,80,.3),m=0;m<15;)v=this._eraseMode?1e3:500*Math.random(),(y=new PVParticle).angle=720*Math.random(),y.flg=!1,Math.random()<.1?(a=255*(Math.random()*this.mColorRandRange-.5*this.mColorRandRange),w=(U=(U=(this.mActiveColor>>16&255)+a)<0?0:U>255?255:U)<<16|(p=(p=(this.mActiveColor>>8&255)+a)<0?0:p>255?255:p)<<8|(i=(i=(this.mActiveColor>>0&255)+a)<0?0:i>255?255:i)):w=this.mActiveColor,y.r=w>>16&255,y.g=w>>8&255,y.b=w>>0&255,f=100*Math.random()-50,c=100*Math.random()-50,c/=o=Math.sqrt(f*f+c*c),f=(f/=o)*(h=50*Math.random()-25)*.45,c=c*h*.45,v<10?(Math.random()<.1?y.scale=6*Math.random():y.scale=3*Math.random(),y.setInitialCondition(e+100*Math.random()-50,s+100*Math.random()-50,0,0,0),y.texIndex=6*Math.random()):v<30?(Math.random()<.1?(y.scale=4*Math.random(),y.texIndex=1):(y.scale=.5*Math.random()+1,y.texIndex=6*Math.random()),_=.7*Math.random()+.3,y.setInitialCondition(e+g*_*15,s+M*_*15,0,0,0)):v<50?(_=.7*Math.random()+.3,y.scale=.5*Math.random()+1,y.setInitialCondition(e+f,s+c,g*_,M*_,30*Math.pow(l,.7)),y.texIndex=0,y.flg=!0):(y.setInitialCondition(e+f,s+c,.1*g,.1*M,30),y.texIndex=Math.random()<.2?1:0,y.scale=.3*Math.random()+1.2),y.scale=1.2*y.scale,y.scale=y.scale*l*50,this.mParticles.push(y),this.mParticles.length>500&&(S=250*Math.random(),this.mParticles.splice(S,1)),++m;++d}this.mPrevDiffX=r,this.mPrevDiffY=n,this.mPrevMouseX=P,this.mPrevMouseY=x},Draw.prototype.endEvent=function(){this.moveFlag=!1,console.log("this.mParticles",this.mParticles)},Draw.prototype.clearCanvas=function(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height)},Draw.prototype.onEnterFrame=function(){let t;this._drawingEnabled&&(this.ctx.fillStyle="rgba(0, 0, 0, 0)",this.mUniformMatrix[0]=0,this.mUniformMatrix[1]=0,this.mUniformMatrix[2]=0,this.mUniformMatrix[3]=1024,this.mUniformColor[0]=1,this.mUniformColor[1]=1,this.mUniformColor[2]=1,this.drawTriangles(this.mUniformMatrix,this.mUniformColor),this.draw(),this.mUniformMatrix[0]=0,this.mUniformMatrix[1]=0,this.mUniformMatrix[2]=0,this.mUniformMatrix[3]=1,this.mUniformColor[0]=1,this.mUniformColor[1]=1,this.mUniformColor[2]=1,this.ctx.fillStyle="rgba(0, 0, 0, 0)",this.mUniformMatrix[1]=0,this.mUniformMatrix[3]=1024,this.drawTriangles(this.mUniformMatrix,this.mUniformColor)),this.ctx.fillStyle="rgba(1, 1, 1, 1)",this.mUniformColor[0]=1,this.mUniformColor[1]=1,this.mUniformColor[2]=1,this.mUniformMatrix[0]=0,this.mUniformMatrix[2]=0;let i=this.mStageWidth*this.currentScale;this.mUniformMatrix[1]=0,this.mUniformMatrix[3]=1.125*i*1.81,this.drawTriangles(this.mUniformMatrix,this.mUniformColor),this.mUniformMatrix[1]=1.125*-i*-.016+0,this.mUniformMatrix[3]=i,this.drawTriangles(this.mUniformMatrix,this.mUniformColor),this.isZoom?1.16!=this._toScale&&(this._toScale=1.16,this._frScale=this.currentScale,this._ticktime=(new Date).getTime()):.6!=this._toScale&&(this._toScale=.6,this._frScale=this.currentScale,this._ticktime=(new Date).getTime()),this.currentScale!=this._toScale&&this._drawingEnabled&&(this._zoomTryed?((t=((new Date).getTime()-this._ticktime)/400)>1&&(t=1),t=easing.easeOutQuart(t,0,1,1)):((t=((new Date).getTime()-this._ticktime)/1e3)>1&&(t=1,this._zoomTryed=!0),t=easing.easeInOutQuart(t,0,1,1)),this.currentScale=this._frScale+(this._toScale-this._frScale)*t)},Draw.prototype.draw=function(){let t=null,i=0,e=0,s=this.mParticles.length;if(s>0){for(i=-1,e=0;e<s;)(t=this.mParticles[e]).flg&&Math.random()>.5||(t.posX>30&&t.posX>12*1.2&&t.posX<368&&t.posY<485.6||this._eraseMode)&&(i!=t.texIndex&&(i=t.texIndex),t.flg||(this.mUniformMatrix[0]=t.posX,this.mUniformMatrix[1]=t.posY,this.mUniformMatrix[3]=t.scale,this.mUniformColor[0]=t.r,this.mUniformColor[1]=t.g,this.mUniformColor[2]=t.b,this.mUniformColor[3]=1),this.mUniformMatrix[2]=t.angle,this.mUniformMatrix[3]=t.scale,this.drawTriangles(this.mUniformMatrix,this.mUniformColor)),t.life>0?(this.mVF.getForceFromPos(t.posX,t.posY),t.setVFupdate(this.mVF.outX,this.mVF.outY),++e):(this.mParticles.splice(e,1),--s);this.mUniformColor[3]=1}this.mVF.fadeField(.96)},Draw.prototype.drawTriangles=function(t,i){this.ctx.fillStyle=`rgba(${i[0]}, ${i[1]}, ${i[2]}, ${i[3]})`,this.ctx.beginPath(),this.ctx.arc(t[0],t[1],2,0,2*Math.PI),this.ctx.fill()},window.requestAnimFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(t){window.setTimeout(t,1e3/60)};